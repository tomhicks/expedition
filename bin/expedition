#!/usr/bin/env node

var expedition = require("../src/writer");
var fs = require('fs-extra');

var argv = require('minimist')(process.argv.slice(2));

if (argv.version) {
  console.log(require('../package').version);
  return;
}

var options = {};
if (typeof argv.dir === 'string') {
  options.dir = argv.dir;
}

if (argv.dev === true || argv.dev === "true") {
  options.dev = true;
}

var writer = expedition(options);

if (argv.input && typeof argv.input === 'string') {
  fs.readJson(argv.input, function (err, json) {
    writer.writeReport(json);
  });
} else {
  var stdin = process.openStdin();
  var data = "";

  stdin.on('data', function (chunk) {
    data += chunk;
  });

  stdin.on('end', function () {
    writer.writeReport(JSON.parse(data), function () {
      process.exit(0);
    });
  });
}
